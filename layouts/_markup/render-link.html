{{- $u := urls.Parse .Destination -}}
{{- $href := $u.String -}}
{{- $isExternal := false -}}

{{- if $u.IsAbs -}}
  {{- $isExternal = true -}}
{{- else if strings.HasPrefix $u.String "#" -}}
  {{- $href = printf "%s#%s" .PageInner.RelPermalink $u.Fragment -}}
{{- else if and $href (not $u.IsAbs) -}}
  {{- /* decode spasi */ -}}
  {{- $decoded := replace $u.Path "%20" " " -}}

  {{- /* slugify per segmen */ -}}
  {{- $segments := split $decoded "/" -}}
  {{- $slugged := slice -}}
  {{- range $segments }}
    {{- if . }}
      {{- $slugged = $slugged | append (urlize .) -}}
    {{- end }}
  {{- end }}
  {{- $path := delimit $slugged "/" -}}

  {{- with or
    ($.PageInner.GetPage $path)
    ($.PageInner.Resources.Get $path)
    (resources.Get $path)
  -}}
    {{- $href = .RelPermalink -}}
    {{- with $u.RawQuery -}}
      {{- $href = printf "%s?%s" $href . -}}
    {{- end -}}
    {{- with $u.Fragment -}}
      {{- $href = printf "%s#%s" $href . -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

<a href="{{ $href }}" 
   {{- with .Title }} title="{{ . }}"{{- end }}
   {{- if $isExternal }} target="_blank" rel="noopener noreferrer"{{- end }}>
   {{ .Text }}
</a>
