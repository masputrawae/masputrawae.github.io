{{ $file := .file }}
{{ $jsBuild := .jsBuild | default true }}

{{- with resources.Get $file }}
  {{- if $jsBuild }}
    {{- $opts := dict
      "minify" (not hugo.IsDevelopment)
      "sourceMap" (cond hugo.IsDevelopment "external" "")
      "targetPath" $file
    }}

    {{- with . | js.Build $opts }}
      {{- if hugo.IsDevelopment }}
        <script src="{{ .RelPermalink }}"></script>
      {{- else }}
        {{- with . | fingerprint }}
          <script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous"></script>
        {{- end }}
      {{- end }}
    {{- end }}
  {{- else }}
    <script src="{{ .RelPermalink }}"></script>
  {{- end }}
{{- end }}